
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Contributor documentation and reference for the Terraform AzureRM Provider">
      
      
      
      
        <link rel="prev" href="../guide-new-resource-vs-inline/">
      
      
        <link rel="next" href="../guide-new-fields-to-resource/">
      
      <link rel="icon" href="../../images/hashicorp-black.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.6">
    
    
      
        <title>Adding a new Feature - Terraform AzureRM Provider - Contributor Guide</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.558e4712.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
    
    
      <link rel="stylesheet" href="../../extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="hashicorp" data-md-color-primary="black" data-md-color-accent="blue">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#guide-adding-a-new-feature-to-the-features-block" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Terraform AzureRM Provider - Contributor Guide" class="md-header__button md-logo" aria-label="Terraform AzureRM Provider - Contributor Guide" data-md-component="logo">
      
  <img src="../../images/hashicorp.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Terraform AzureRM Provider - Contributor Guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Adding a new Feature
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hashicorp/terraform-provider-azurerm" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    hashicorp/terraform-provider-azurerm
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Terraform AzureRM Provider - Contributor Guide" class="md-nav__button md-logo" aria-label="Terraform AzureRM Provider - Contributor Guide" data-md-component="logo">
      
  <img src="../../images/hashicorp.png" alt="logo">

    </a>
    Terraform AzureRM Provider - Contributor Guide
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hashicorp/terraform-provider-azurerm" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    hashicorp/terraform-provider-azurerm
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" tabindex="0" aria-expanded="false">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../high-level-overview/" class="md-nav__link">
        Overview of the Provider
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../building-the-provider/" class="md-nav__link">
        Building the Provider
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../debugging-the-provider/" class="md-nav__link">
        Debugging the Provider
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../running-the-tests/" class="md-nav__link">
        Running Tests
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../guide-opening-a-pr/" class="md-nav__link">
        Opening a Pull Request
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" tabindex="0" aria-expanded="false">
          Creating New Resources & Data Sources
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Creating New Resources & Data Sources" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Creating New Resources & Data Sources
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../guide-new-service-package/" class="md-nav__link">
        Adding a new Service Package
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../guide-new-resource/" class="md-nav__link">
        Adding a new Resource
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../guide-list-resource/" class="md-nav__link">
        Adding a new List Resource
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../guide-new-data-source/" class="md-nav__link">
        Adding a new Data Source
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../guide-new-resource-vs-inline/" class="md-nav__link">
        When to create a new Resource vs Inline Block
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4" tabindex="0" aria-expanded="true">
          Extending Existing Resources
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Extending Existing Resources" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Extending Existing Resources
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Adding a new Feature
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Adding a new Feature
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#updating-internalfeatures" class="md-nav__link">
    Updating internal/features
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#updating-internalprovider" class="md-nav__link">
    Updating internal/provider
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#updating-internalproviderframework" class="md-nav__link">
    Updating internal/provider/framework
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-the-resource" class="md-nav__link">
    Update the resource
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../guide-new-fields-to-resource/" class="md-nav__link">
        Adding fields to an existing Resource
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../guide-new-fields-to-data-source/" class="md-nav__link">
        Adding fields to an existing Data Source
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../guide-resource-identity/" class="md-nav__link">
        Adding Resource Identity
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../guide-new-write-only-attribute/" class="md-nav__link">
        Adding Write-Only Attributes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" tabindex="0" aria-expanded="false">
          Maintenance & Updates
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Maintenance & Updates" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Maintenance & Updates
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../guide-api-version/" class="md-nav__link">
        Updating API Versions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../guide-state-migrations/" class="md-nav__link">
        Adding State Migrations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../guide-breaking-changes/" class="md-nav__link">
        Breaking Changes and Deprecations
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" tabindex="0" aria-expanded="false">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../reference-acceptance-testing/" class="md-nav__link">
        Acceptance Testing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../best-practices/" class="md-nav__link">
        Best Practices
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../reference-glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../reference-naming/" class="md-nav__link">
        Naming
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../guide-resource-ids/" class="md-nav__link">
        Resource IDs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../schema-design-considerations/" class="md-nav__link">
        Schema Design
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../reference-documentation-standards/" class="md-nav__link">
        Provider Documentation Standards
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../reference-errors/" class="md-nav__link">
        Working with Errors
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
        <label class="md-nav__link" for="__nav_7" tabindex="0" aria-expanded="false">
          Maintainers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Maintainers" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Maintainers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../maintainer-merging/" class="md-nav__link">
        Merging PRs
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../frequently-asked-questions/" class="md-nav__link">
        FAQ
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#updating-internalfeatures" class="md-nav__link">
    Updating internal/features
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#updating-internalprovider" class="md-nav__link">
    Updating internal/provider
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#updating-internalproviderframework" class="md-nav__link">
    Updating internal/provider/framework
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-the-resource" class="md-nav__link">
    Update the resource
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  



<h1 id="guide-adding-a-new-feature-to-the-features-block">Guide: Adding a new Feature to the Features Block<a class="headerlink" href="#guide-adding-a-new-feature-to-the-features-block" title="Permanent link">#</a></h1>
<p>This guide covers how to add a new Feature to the Features Block (<a href="https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/guides/features-block">Terraform Docs</a>) that will change the default behaviour for how a resource or service works. Reasons for this can include:</p>
<ul>
<li>
<p>Purging a resource during delete</p>
</li>
<li>
<p>Recovering a resource that has been soft deleted during create</p>
</li>
<li>
<p>Detach a connected resource during deletion</p>
</li>
</ul>
<p>Following are the steps needed to add a new Feature to the Feature Block:</p>
<blockquote>
<p><strong>Note:</strong> The Azure Provider is in the process of moving towards a new Framework Plugin for the provider. Because of this, we must update the provider in a few areas when adding a new feature. We'll update the following areas <code>internal/features</code>, <code>internal/provider</code>, <code>internal/provider/framework</code>, and the resource file itself.</p>
</blockquote>
<h3 id="updating-internalfeatures">Updating <code>internal/features</code><a class="headerlink" href="#updating-internalfeatures" title="Permanent link">#</a></h3>
<ol>
<li>Update <code>internal/features/user_flags.go</code> with either a new block for the service package or updating an existing service package with the new feature to add. Added struct names should represent the service package they affect, and feature names should concisely describe their effect.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">UserFeatures</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">KeyVault</span><span class="w"> </span><span class="nx">KeyVaultFeatures</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">KeyVaultFeatures</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">PurgeSoftDeleteOnDestroy</span><span class="w"> </span><span class="kt">bool</span>
<span class="p">}</span>
</code></pre></div>
<ol>
<li>Update <code>internal/features/defaults.go</code> with what the default value for the new feature will be. This must represent the current default behaviour of the resource(s) to avoid this becoming a breaking change when the feature flagged behaviour is added to the target resource(s).</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">Default</span><span class="p">()</span><span class="w"> </span><span class="nx">UserFeatures</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">UserFeatures</span><span class="p">{</span>
<span class="w">    </span><span class="o">...</span>
<span class="w">    </span><span class="nx">KeyVault</span><span class="p">:</span><span class="w"> </span><span class="nx">KeyVaultFeatures</span><span class="p">{</span>
<span class="w">        </span><span class="nx">PurgeSoftDeleteOnDestroy</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="o">...</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="updating-internalprovider">Updating <code>internal/provider</code><a class="headerlink" href="#updating-internalprovider" title="Permanent link">#</a></h3>
<ol>
<li>Update <code>internal/provider/feature.go</code> with what the Terraform schema will look like and how to thread it into the features block</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">schemaFeatures</span><span class="p">(</span><span class="nx">supportLegacyTestSuite</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">pluginsdk</span><span class="p">.</span><span class="nx">Schema</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">featuresMap</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="nx">pluginsdk</span><span class="p">.</span><span class="nx">Schema</span><span class="p">{</span>
<span class="w">        </span><span class="o">...</span>
<span class="w">        </span><span class="s">&quot;key_vault&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">Type</span><span class="p">:</span><span class="w">     </span><span class="nx">pluginsdk</span><span class="p">.</span><span class="nx">TypeList</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Optional</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="nx">MaxItems</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Elem</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">pluginsdk</span><span class="p">.</span><span class="nx">Resource</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Schema</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="nx">pluginsdk</span><span class="p">.</span><span class="nx">Schema</span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;purge_soft_delete_on_destroy&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">Description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;When enabled soft-deleted `azurerm_key_vault` resources will be permanently deleted (e.g purged), when destroyed&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">Type</span><span class="p">:</span><span class="w">        </span><span class="nx">pluginsdk</span><span class="p">.</span><span class="nx">TypeBool</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">Optional</span><span class="p">:</span><span class="w">    </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">Default</span><span class="p">:</span><span class="w">     </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="o">...</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">expandFeatures</span><span class="p">(</span><span class="nx">input</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="nx">features</span><span class="p">.</span><span class="nx">UserFeatures</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">...</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">raw</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">val</span><span class="p">[</span><span class="s">&quot;key_vault&quot;</span><span class="p">];</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">items</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">raw</span><span class="p">.([]</span><span class="kd">interface</span><span class="p">{})</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">items</span><span class="p">)</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">keyVaultRaw</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">items</span><span class="p">[</span><span class="mi">0</span><span class="p">].(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{})</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">v</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">keyVaultRaw</span><span class="p">[</span><span class="s">&quot;purge_soft_delete_on_destroy&quot;</span><span class="p">];</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">featuresMap</span><span class="p">.</span><span class="nx">KeyVault</span><span class="p">.</span><span class="nx">PurgeSoftDeleteOnDestroy</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">v</span><span class="p">.(</span><span class="kt">bool</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="o">...</span>
<span class="p">}</span>
</code></pre></div>
<ol>
<li>Update <code>internal/provider/feature_test.go</code> to include a test for every permutation of the feature you are adding to the TestExpandFeatures test and a test dedicated to the service package of the feature.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestExpandFeatures</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">testData</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">Name</span><span class="w">     </span><span class="kt">string</span>
<span class="w">        </span><span class="nx">Input</span><span class="w">    </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}</span>
<span class="w">        </span><span class="nx">EnvVars</span><span class="w">  </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span>
<span class="w">        </span><span class="nx">Expected</span><span class="w"> </span><span class="nx">features</span><span class="p">.</span><span class="nx">UserFeatures</span>
<span class="w">    </span><span class="p">}{</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nx">Name</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;Empty Block&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Input</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{},</span>
<span class="w">            </span><span class="nx">Expected</span><span class="p">:</span><span class="w"> </span><span class="nx">features</span><span class="p">.</span><span class="nx">UserFeatures</span><span class="p">{</span>
<span class="w">                </span><span class="o">...</span>
<span class="w">                </span><span class="nx">KeyVault</span><span class="p">:</span><span class="w"> </span><span class="nx">features</span><span class="p">.</span><span class="nx">KeyVaultFeatures</span><span class="p">{</span>
<span class="w">                    </span><span class="nx">PurgeSoftDeleteOnDestroy</span><span class="p">:</span><span class="w">         </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="o">...</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Complete Enabled&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Input</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="o">...</span>
<span class="w">                    </span><span class="s">&quot;key_vault&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                            </span><span class="s">&quot;purge_soft_delete_on_destroy&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                        </span><span class="p">},</span>
<span class="w">                    </span><span class="p">},</span><span class="w">   </span>
<span class="w">                    </span><span class="o">...</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nx">Expected</span><span class="p">:</span><span class="w"> </span><span class="nx">features</span><span class="p">.</span><span class="nx">UserFeatures</span><span class="p">{</span>
<span class="w">                </span><span class="o">...</span>
<span class="w">                </span><span class="nx">KeyVault</span><span class="p">:</span><span class="w"> </span><span class="nx">features</span><span class="p">.</span><span class="nx">KeyVaultFeatures</span><span class="p">{</span>
<span class="w">                    </span><span class="nx">PurgeSoftDeleteOnDestroy</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="o">...</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Complete Disabled&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Input</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="o">...</span>
<span class="w">                    </span><span class="s">&quot;key_vault&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                            </span><span class="s">&quot;purge_soft_delete_on_destroy&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">                        </span><span class="p">},</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                    </span><span class="o">...</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nx">Expected</span><span class="p">:</span><span class="w"> </span><span class="nx">features</span><span class="p">.</span><span class="nx">UserFeatures</span><span class="p">{</span>
<span class="w">                </span><span class="o">...</span>
<span class="w">                </span><span class="nx">KeyVault</span><span class="p">:</span><span class="w"> </span><span class="nx">features</span><span class="p">.</span><span class="nx">KeyVaultFeatures</span><span class="p">{</span>
<span class="w">                </span><span class="nx">PurgeSoftDeleteOnDestroy</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="o">...</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span><span class="w">  </span>
<span class="p">}</span>


<span class="kd">func</span><span class="w"> </span><span class="nx">TestExpandFeaturesKeyVault</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">testData</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">Name</span><span class="w">     </span><span class="kt">string</span>
<span class="w">        </span><span class="nx">Input</span><span class="w">    </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}</span>
<span class="w">        </span><span class="nx">EnvVars</span><span class="w">  </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span>
<span class="w">        </span><span class="nx">Expected</span><span class="w"> </span><span class="nx">features</span><span class="p">.</span><span class="nx">UserFeatures</span>
<span class="w">    </span><span class="p">}{</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Empty Block&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Input</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="s">&quot;key_vault&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{},</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nx">Expected</span><span class="p">:</span><span class="w"> </span><span class="nx">features</span><span class="p">.</span><span class="nx">UserFeatures</span><span class="p">{</span>
<span class="w">                </span><span class="nx">KeyVault</span><span class="p">:</span><span class="w"> </span><span class="nx">features</span><span class="p">.</span><span class="nx">KeyVaultFeatures</span><span class="p">{</span>
<span class="w">                    </span><span class="nx">PurgeSoftDeleteOnDestroy</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Purge Soft Delete On Destroy&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Input</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="s">&quot;key_vault&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                            </span><span class="s">&quot;purge_soft_delete_on_destroy&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                        </span><span class="p">},</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nx">Expected</span><span class="p">:</span><span class="w"> </span><span class="nx">features</span><span class="p">.</span><span class="nx">UserFeatures</span><span class="p">{</span>
<span class="w">                </span><span class="nx">KeyVault</span><span class="p">:</span><span class="w"> </span><span class="nx">features</span><span class="p">.</span><span class="nx">KeyVaultFeatures</span><span class="p">{</span>
<span class="w">                    </span><span class="nx">PurgeSoftDeleteOnDestroy</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Purge Soft Delete On Destroy Disabled&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Input</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="s">&quot;key_vault&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                            </span><span class="s">&quot;purge_soft_delete_on_destroy&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">                        </span><span class="p">},</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nx">Expected</span><span class="p">:</span><span class="w"> </span><span class="nx">features</span><span class="p">.</span><span class="nx">UserFeatures</span><span class="p">{</span>
<span class="w">                </span><span class="nx">KeyVault</span><span class="p">:</span><span class="w"> </span><span class="nx">features</span><span class="p">.</span><span class="nx">KeyVaultFeatures</span><span class="p">{</span>
<span class="w">                    </span><span class="nx">PurgeSoftDeleteOnDestroy</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">testCase</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">testData</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">t</span><span class="p">.</span><span class="nx">Logf</span><span class="p">(</span><span class="s">&quot;[DEBUG] Test Case: %q&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">testCase</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<span class="w">        </span><span class="nx">result</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">expandFeatures</span><span class="p">(</span><span class="nx">testCase</span><span class="p">.</span><span class="nx">Input</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">DeepEqual</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">KeyVault</span><span class="p">,</span><span class="w"> </span><span class="nx">testCase</span><span class="p">.</span><span class="nx">Expected</span><span class="p">.</span><span class="nx">KeyVault</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">t</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;Expected %+v but got %+v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">KeyVault</span><span class="p">,</span><span class="w"> </span><span class="nx">testCase</span><span class="p">.</span><span class="nx">Expected</span><span class="p">.</span><span class="nx">KeyVault</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="updating-internalproviderframework">Updating <code>internal/provider/framework</code><a class="headerlink" href="#updating-internalproviderframework" title="Permanent link">#</a></h3>
<ol>
<li>Update <code>internal/provider/framework/model.go</code></li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1">// For new services, add a List type for the new block with a `tfsdk` struct tag that matches the schema name for the block, for new features in an existing block/service, this can be skipped.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Features</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">...</span>
<span class="w">    </span><span class="nx">KeyVault</span><span class="w"> </span><span class="nx">types</span><span class="p">.</span><span class="nx">List</span><span class="w"> </span><span class="s">`tfsdk:&quot;key_vault&quot;`</span>
<span class="w">    </span><span class="o">...</span>
<span class="p">}</span>

<span class="c1">// and an attribute map variable for the block, or add to the appropriate existing var</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">FeaturesAttributes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">attr</span><span class="p">.</span><span class="nx">Type</span><span class="p">{</span>
<span class="w">    </span><span class="o">...</span>
<span class="w">    </span><span class="s">&quot;key_vault&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">types</span><span class="p">.</span><span class="nx">ListType</span><span class="p">{}.</span><span class="nx">WithElementType</span><span class="p">(</span><span class="nx">types</span><span class="p">.</span><span class="nx">ObjectType</span><span class="p">{}.</span><span class="nx">WithAttributeTypes</span><span class="p">(</span><span class="nx">KeyVaultAttributes</span><span class="p">)),</span>
<span class="w">    </span><span class="o">...</span>
<span class="p">}</span>

<span class="c1">// Add a Go struct that matches the new block or add to the appropriate existing struct</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">KeyVault</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">PurgeSoftDeleteOnDestroy</span><span class="w"> </span><span class="nx">types</span><span class="p">.</span><span class="nx">Bool</span><span class="w"> </span><span class="s">`tfsdk:&quot;purge_soft_delete_on_destroy&quot;`</span>
<span class="p">}</span>

<span class="c1">// finally, create the attribute map variable for the new block, or add the feature to the appropriate existing map</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">KeyVaultAttributes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">attr</span><span class="p">.</span><span class="nx">Type</span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;purge_soft_delete_on_destroy&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">types</span><span class="p">.</span><span class="nx">BoolType</span>
<span class="p">}</span>
</code></pre></div>
<ol>
<li>Update <code>internal/provider/framework/provider.go</code></li>
</ol>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">azureRmFrameworkProvider</span><span class="p">)</span><span class="w"> </span><span class="nx">Schema</span><span class="p">(</span><span class="nx">_</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="nx">provider</span><span class="p">.</span><span class="nx">SchemaRequest</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">*</span><span class="nx">provider</span><span class="p">.</span><span class="nx">SchemaResponse</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">response</span><span class="p">.</span><span class="nx">Schema</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">schema</span><span class="p">.</span><span class="nx">Schema</span><span class="p">{</span>
<span class="w">        </span><span class="o">...</span>
<span class="w">        </span><span class="nx">Blocks</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">schema</span><span class="p">.</span><span class="nx">Block</span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;features&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">schema</span><span class="p">.</span><span class="nx">ListNestedBlock</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Validators</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="nx">validator</span><span class="p">.</span><span class="nx">List</span><span class="p">{</span>
<span class="w">                    </span><span class="nx">listvalidator</span><span class="p">.</span><span class="nx">SizeBetween</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="nx">NestedObject</span><span class="p">:</span><span class="w"> </span><span class="nx">schema</span><span class="p">.</span><span class="nx">NestedBlockObject</span><span class="p">{</span>
<span class="w">                    </span><span class="nx">Blocks</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">schema</span><span class="p">.</span><span class="nx">Block</span><span class="p">{</span>
<span class="w">                        </span><span class="o">...</span>
<span class="w">                        </span><span class="c1">// Add an attribute map variable for the new block or add to the existing map inside the Nested Object</span>
<span class="w">                        </span><span class="s">&quot;key_vault&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">schema</span><span class="p">.</span><span class="nx">ListNestedBlock</span><span class="p">{</span>
<span class="w">                            </span><span class="nx">NestedObject</span><span class="p">:</span><span class="w"> </span><span class="nx">schema</span><span class="p">.</span><span class="nx">NestedBlockObject</span><span class="p">{</span>
<span class="w">                                </span><span class="nx">Attributes</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">schema</span><span class="p">.</span><span class="nx">Attribute</span><span class="p">{</span>
<span class="w">                                    </span><span class="s">&quot;purge_soft_delete_on_destroy&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">schema</span><span class="p">.</span><span class="nx">BoolAttribute</span><span class="p">{</span>
<span class="w">                                        </span><span class="nx">Description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;When enabled soft-deleted `azurerm_key_vault` resources will be permanently deleted (e.g purged), when destroyed&quot;</span><span class="p">,</span>
<span class="w">                                        </span><span class="nx">Optional</span><span class="p">:</span><span class="w">    </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                                   </span><span class="p">},</span>
<span class="w">                                </span><span class="p">},</span>
<span class="w">                            </span><span class="p">},</span>
<span class="w">                        </span><span class="p">},</span>
<span class="w">                        </span><span class="o">...</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span><span class="w">  </span>
<span class="w">        </span><span class="o">...</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ol>
<li>Update <code>internal/provider/framework/config.go</code></li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1">// Add a new check that the feature has been specified in the config that then loads the feature into the provider or add the new feature to the existing block.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">ProviderConfig</span><span class="p">)</span><span class="w"> </span><span class="nx">Load</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">*</span><span class="nx">ProviderModel</span><span class="p">,</span><span class="w"> </span><span class="nx">tfVersion</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">diags</span><span class="w"> </span><span class="o">*</span><span class="nx">diag</span><span class="p">.</span><span class="nx">Diagnostics</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">...</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">features</span><span class="p">.</span><span class="nx">KeyVault</span><span class="p">.</span><span class="nx">IsNull</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">!</span><span class="nx">features</span><span class="p">.</span><span class="nx">KeyVault</span><span class="p">.</span><span class="nx">IsUnknown</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">feature</span><span class="w"> </span><span class="p">[]</span><span class="nx">KeyVault</span>
<span class="w">        </span><span class="nx">d</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">features</span><span class="p">.</span><span class="nx">KeyVault</span><span class="p">.</span><span class="nx">ElementsAs</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">feature</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="w">        </span><span class="nx">diags</span><span class="p">.</span><span class="nx">Append</span><span class="p">(</span><span class="nx">d</span><span class="o">...</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">diags</span><span class="p">.</span><span class="nx">HasError</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">f</span><span class="p">.</span><span class="nx">KeyVault</span><span class="p">.</span><span class="nx">PurgeSoftDeleteOnDestroy</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">feature</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">PurgeSoftDeleteOnDestroy</span><span class="p">.</span><span class="nx">IsNull</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">!</span><span class="nx">feature</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">PurgeSoftDeleteOnDestroy</span><span class="p">.</span><span class="nx">IsUnknown</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">f</span><span class="p">.</span><span class="nx">KeyVault</span><span class="p">.</span><span class="nx">PurgeSoftDeleteOnDestroy</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">feature</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">PurgeSoftDeleteOnDestroy</span><span class="p">.</span><span class="nx">ValueBool</span><span class="p">()</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="o">...</span>
<span class="p">}</span>
</code></pre></div>
<ol>
<li>Update  <code>internal/provider/framework/config_test.go</code> with the Features Model and Attributes</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">defaultFeaturesList</span><span class="p">()</span><span class="w"> </span><span class="nx">types</span><span class="p">.</span><span class="nx">List</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">...</span>
<span class="w">    </span><span class="c1">// Add a NewObjectValueFrom that holds what type of feature you have or append to the existing ObjectValueFrom</span>
<span class="w">    </span><span class="nx">keyVault</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">basetypes</span><span class="p">.</span><span class="nx">NewObjectValueFrom</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">KeyVaultAttributes</span><span class="p">,</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">attr</span><span class="p">.</span><span class="nx">Value</span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;purge_soft_delete_on_destroy&quot;</span><span class="p">:</span><span class="w">                            </span><span class="nx">basetypes</span><span class="p">.</span><span class="nx">NewBoolNull</span><span class="p">(),</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="nx">keyVaultList</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">basetypes</span><span class="p">.</span><span class="nx">NewListValue</span><span class="p">(</span><span class="nx">types</span><span class="p">.</span><span class="nx">ObjectType</span><span class="p">{}.</span><span class="nx">WithAttributeTypes</span><span class="p">(</span><span class="nx">KeyVaultAttributes</span><span class="p">),</span><span class="w"> </span><span class="p">[]</span><span class="nx">attr</span><span class="p">.</span><span class="nx">Value</span><span class="p">{</span><span class="nx">keyVault</span><span class="p">})</span>
<span class="w">    </span><span class="o">...</span>
<span class="w">    </span><span class="c1">// If the added feature is supporting a new service, add it to the following list of services</span>
<span class="w">    </span><span class="nx">fData</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">basetypes</span><span class="p">.</span><span class="nx">NewObjectValue</span><span class="p">(</span><span class="nx">FeaturesAttributes</span><span class="p">,</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">attr</span><span class="p">.</span><span class="nx">Value</span><span class="p">{</span>
<span class="w">        </span><span class="o">...</span>
<span class="w">        </span><span class="s">&quot;key_vault&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">keyVaultList</span><span class="p">,</span>
<span class="w">        </span><span class="o">...</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="update-the-resource">Update the resource<a class="headerlink" href="#update-the-resource" title="Permanent link">#</a></h3>
<ol>
<li>Update <code>internal/service/serviceName/resourceName.go</code> in this case <code>internal/service/keyvault/key_vault_resource.go</code> to include the functionality of the added feature.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">resourceKeyVaultDelete</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="o">*</span><span class="nx">pluginsdk</span><span class="p">.</span><span class="nx">ResourceData</span><span class="p">,</span><span class="w"> </span><span class="nx">meta</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">...</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">meta</span><span class="p">.(</span><span class="o">*</span><span class="nx">clients</span><span class="p">.</span><span class="nx">Client</span><span class="p">).</span><span class="nx">Features</span><span class="p">.</span><span class="nx">KeyVault</span><span class="p">.</span><span class="nx">PurgeSoftDeleteOnDestroy</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Purge the Keyvault</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="o">...</span>
<span class="p">}</span>
</code></pre></div>
<ol>
<li>Update <code>internal/service/serviceName/resourceName_test.go</code> in this case <code>internal/service/keyvault/key_vault_resource_test.go</code> to test the new feature.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestAccKeyVault_softDeleteRecoveryDisabled</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">acceptance</span><span class="p">.</span><span class="nx">BuildTestData</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;azurerm_key_vault&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;test&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">r</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">KeyVaultResource</span><span class="p">{}</span>

<span class="w">    </span><span class="nx">data</span><span class="p">.</span><span class="nx">ResourceTest</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="nx">acceptance</span><span class="p">.</span><span class="nx">TestStep</span><span class="p">{</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// create it regularly</span>
<span class="w">            </span><span class="nx">Config</span><span class="p">:</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">softDeleteRecoveryDisabled</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span>
<span class="w">            </span><span class="nx">Check</span><span class="p">:</span><span class="w"> </span><span class="nx">acceptance</span><span class="p">.</span><span class="nx">ComposeTestCheckFunc</span><span class="p">(</span>
<span class="w">                </span><span class="nx">check</span><span class="p">.</span><span class="nx">That</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">ResourceName</span><span class="p">).</span><span class="nx">ExistsInAzure</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span>
<span class="w">                </span><span class="nx">check</span><span class="p">.</span><span class="nx">That</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">ResourceName</span><span class="p">).</span><span class="nx">Key</span><span class="p">(</span><span class="s">&quot;purge_protection_enabled&quot;</span><span class="p">).</span><span class="nx">HasValue</span><span class="p">(</span><span class="s">&quot;false&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="p">),</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">data</span><span class="p">.</span><span class="nx">ImportStep</span><span class="p">(),</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// delete the key vault</span>
<span class="w">            </span><span class="nx">Config</span><span class="p">:</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">softDeleteAbsent</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// attempting to re-create it requires recovery, which is enabled by default</span>
<span class="w">            </span><span class="nx">Config</span><span class="p">:</span><span class="w">      </span><span class="nx">r</span><span class="p">.</span><span class="nx">softDeleteRecoveryDisabled</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span>
<span class="w">            </span><span class="nx">ExpectError</span><span class="p">:</span><span class="w"> </span><span class="nx">regexp</span><span class="p">.</span><span class="nx">MustCompile</span><span class="p">(</span><span class="s">&quot;An existing soft-deleted Key Vault exists with the Name&quot;</span><span class="p">),</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">KeyVaultResource</span><span class="p">)</span><span class="w"> </span><span class="nx">softDeleteRecoveryDisabled</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="nx">acceptance</span><span class="p">.</span><span class="nx">TestData</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">`</span>
<span class="s">provider &quot;azurerm&quot; {</span>
<span class="s">  features {</span>
<span class="s">    key_vault {</span>
<span class="s">      recover_soft_deleted_key_vaults = false</span>
<span class="s">    }</span>
<span class="s">  }</span>
<span class="s">}</span>
<span class="s">...</span>
<span class="s">`</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>At this point, if all tests have passed including the tests found in <code>internal/provider/function/normalise_resource_id_test.go</code> and <code>internal/provider/function/parse_resource_id_test.go</code>, the Feature should be implemented and ready for use. </p>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      HashiCorp
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.51d95adb.min.js"></script>
      
    
  </body>
</html>